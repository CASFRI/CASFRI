rule_id,target_attribute,target_attribute_type,validation_rules,translation_rules,description,desc_uptodate_with_rules
1,CAS_ID,text,notEmpty(inventory_id);notEmpty(src_filename);notNull(map_sheet_id);notNull(orig_stand_id);notNull(ogc_fid),"padConcat({inventory_id, src_filename, map_sheet_id, orig_stand_id, ogc_fid}, {4,15,10,10,7}, {'x','x','x','x','x'}, '-', TRUE, TRUE)",Concatenates five attributes to create CAS_ID,TRUE
2,INVENTORY_ID,text,notEmpty(inventory_id),copyText(inventory_id),Copies source value,TRUE
3,ORIG_STAND_ID,text,notNull(orig_stand_id),copyText(orig_stand_id),Copies source value ,TRUE
4,STAND_STRUCTURE,text,"avi01_stand_structure_validation(stand_structure, nfl, anth_veg, anth_non, nat_non);hasCountOfNotNull(stand_structure, species_1_layer1, species_2_layer1, species_3_layer1, species_1_layer2, species_2_layer2, species_3_layer2, 1, FALSE|NOT_APPLICABLE)","avi01_stand_structure_translation(stand_structure, species_1_layer1, species_2_layer1, species_3_layer1, species_1_layer2, species_2_layer2, species_3_layer2)","avi01_stand_structure_validation returns NOT_APPLICABLE for any NFL rows, unless they have horizontal structure. If there is no stand structure or species info, NOT_APPLICABLE is returned. Translation returns HORIZONTAL or COMPLEX, SINGLE_LAYERED if one forest layer, MULTI_LAYERED if two forest layers. Note that the source stand structure counted NFL layers as forest layers, CASFRI does not.",TRUE
5,NUM_OF_LAYERS,integer,"hasCountOfNotNull({species_1_layer1}, {species_1_layer2}, {nfl_layer, anth_veg_layer, anth_non_layer, nat_non_layer}, {unfl_layer, uanth_veg_layer, uanth_non_layer, unat_non_layer}, 1, FALSE|-8886)","countOfNotNull({species_1_layer1}, {species_1_layer2}, {nfl_layer, anth_veg_layer, anth_non_layer, nat_non_layer}, {unfl_layer, uanth_veg_layer, uanth_non_layer, unat_non_layer}, 4, FALSE)","Counts number of layers based on the presence of a not null value for attributes representing each layer. Assumes valid LYR1 row must have sp1, LYR2 must have usp1, NFL1 must have nfl or anth_veg or anth_non or nat_non, NFL2 must have unfl or uanth_veg or uanth_non or unat_non. Validation returns UNKNOWN_VALUE is NUM_OF_LAYERS is zero.",TRUE
6,MAP_SHEET_ID,text,notNull(map_sheet_id_2);notEmpty(map_sheet_id_2),copyText(map_sheet_id_2),Copies source value,TRUE
7,CASFRI_AREA,double precision,"geoIsValid(wkb_geometry, TRUE|-8888)",geoArea(wkb_geometry),Validates geometry then calculates area,TRUE
8,CASFRI_PERIMETER,double precision,"geoIsValid(wkb_geometry, TRUE|-8888)",geoPerimeter(wkb_geometry),Validates geometry then calculates perimeter,TRUE
9,SRC_INV_AREA,double precision,"notNull(src_inv_area);isNumeric(src_inv_area);isGreaterThan(src_inv_area, 0, FALSE|-9999)","divideDouble(src_inv_area, 10000)",Converts source area from m2 to ha. Return OUT_OF_RANGE for any zero values.,TRUE
10,STAND_PHOTO_YEAR,integer,"ab_photo_year_validation(inventory_id, wkb_geometry, 'rawfri', photo_year_tbl, 'wkb_geometry', stand_photo_year, 1900, 2021, data_yr)","ab_photo_year_translation(inventory_id, wkb_geometry, 'rawfri',  photo_year_tbl, 'wkb_geometry', photo_year_column, stand_photo_year, data_yr)","For pre-AB25 datasets: Validates geometry, checks source polygon intersects photoyear polygons, runs the intersect to identify photo year with greatest area overlap. Returns -9997 if polygon does not intersect photo year table or geometry is invalid. For post AB25 datasets: copies photo year attribute, returns -9997 if photo year is null, empty, or not between 1900 and 2020.",TRUE
