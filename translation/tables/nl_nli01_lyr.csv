rule_id,target_attribute,target_attribute_type,validation_rules,translation_rules,description,desc_uptodate_with_rules
0,ROW_TRANSLATION_RULE,NA,"matchList(stand_id, {930});nl_nli01_isForest(stand_id, working_group)",NA,"Translate all forest, plus any treed bog polygons that will be recorded in PRODUCTIVITY_TYPE. isForest selects all commercial and non-commercial rows.",TRUE
1,CAS_ID,text,notEmpty(inventory_id);notEmpty(src_filename);notNull(orig_stand_id);notNull(lcov_id_1);notNull(ogc_fid),"padConcat({inventory_id, src_filename, orig_stand_id, lcov_id_1, ogc_fid}, {4,15,10,10,7}, {'x','x','x','x','x'}, '-', TRUE, TRUE)",Concatenates five attributes to create CAS_ID,TRUE
2,SOIL_MOIST_REG,text,"nl_nli01_isNonCommercial(stand_id, working_group|NOT_APPLICABLE);notNull(soil_moisture_regime);notEmpty(soil_moisture_regime);matchList(soil_moisture_regime,{'d','D','w','W'})","mapText(soil_moisture_regime, {'d','D','w','W'}, {'DRY','DRY','WET','WET'})",Soil moisture only valid for non commercial stands,TRUE
3,STRUCTURE_PER,integer,true(),copyInt(100),No horizontal structure so structure percent is 100,TRUE
4,STRUCTURE_RANGE,double precision,false(),nothingDouble(),No complex structure,TRUE
5,LAYER,integer,true(),copyInt(1),Only 1 layer possible in NL. Every polygon is either LYR or NFL.,TRUE
6,LAYER_RANK,integer,false(),nothingInt(),Attribute does not occur,TRUE
7,CROWN_CLOSURE_UPPER,integer,"notNull(crown_closure_upper);notEmpty(crown_closure_upper|-8888);isInt(crown_closure_upper);isBetween(crown_closure_upper, 1, 4|-9997);nl_nli01_crown_closure_validation(stand_id, working_group, crown_closure_upper|-9997)","nl_nli01_crown_closure_upper_translation(stand_id, working_group, crown_closure_upper)","Translation is different for commercial and non commercial forest. Check there is a valid density code of 1, 2, 3 or 4. 4 is only valid for non commercial so make sure commercial doesn`t have value 4. Translation determines if polygon is commercial or non commercial based on stand_id and working_group. Then runs either the commercial or non commercial mapping.",TRUE
8,CROWN_CLOSURE_LOWER,integer,"notNull(crown_closure_lower);notEmpty(crown_closure_lower|-8888);isInt(crown_closure_lower);isBetween(crown_closure_lower, 1, 4|-9997);nl_nli01_crown_closure_validation(stand_id, working_group, crown_closure_lower|-9997)","nl_nli01_crown_closure_lower_translation(stand_id, working_group, crown_closure_lower)","Translation is different for commercial and non commercial forest. Check there is a valid density code of 1, 2, 3 or 4. 4 is only valid for non commercial so make sure commercial doesn`t have value 4. Translation determines if polygon is commercial or non commercial based on stand_id and working_group. Then runs either the commercial or non commercial mapping.",TRUE
9,HEIGHT_UPPER,double precision,"notNull(height_upper);notEmpty(height_upper|-8888);isInt(height_upper);isBetween(height_upper, 1, 8|-9997);nl_nli01_height_validation(stand_id, working_group, height_upper|-9997)","nl_nli01_height_upper_translation(stand_id, working_group, height_upper)",Translation is different for commercial and non commercial forest. Check there is a valid height code of 1 to 8. 6 to 8 are only valid for commercial so make sure non commercial doesnt have these values. Translation determines if polygon is commercial or non commercial based on stand_id and working_group. Then runs either the commercial or non commercial mapping.,TRUE
10,HEIGHT_LOWER,double precision,"notNull(height_lower);notEmpty(height_lower|-8888);isInt(height_lower);isBetween(height_lower, 1, 8|-9997);nl_nli01_height_validation(stand_id, working_group, height_lower|-9997)","nl_nli01_height_lower_translation(stand_id, working_group, height_lower)",Translation is different for commercial and non commercial forest. Check there is a valid height code of 1 to 8. 6 to 8 are only valid for commercial so make sure non commercial doesnt have these values. Translation determines if polygon is commercial or non commercial based on stand_id and working_group. Then runs either the commercial or non commercial mapping.,TRUE
11,PRODUCTIVITY,text,"nl_nli01_isForest(stand_id, working_group|UNKNOWN_VALUE)","nl_nli01_productivity_translation(stand_id, working_group)",Validate that polygon is either commercial or non commercial. Treed bog is neither so will return UNKNOWN_VALUE. Translate non commercial polygons to NON_PRODUCTIVE_FOREST and commercial to PRODUCTIVE_FOREST.,TRUE
12,PRODUCTIVITY_TYPE,text,true(),"nl_nli01_productivity_type_translation(stand_id, working_group)","Translate treed bog to TREED_MUSKEG, the non commercial polygons to SCRUB_SHRUB, and the commercial to HARVESTABLE",TRUE
13,SPECIES_1,text,"nl_nli01_isCommercial(stand_id, working_group|NOT_APPLICABLE);notNull(species_1);notEmpty(species_1);lengthMatchList(species_1, {2,4,6}|NOT_APPLICABLE);matchTableSubstring(species_1, 1,2, 'translation', 'species_code_mapping', 'nl_species_codes', TRUE, TRUE)","lookupTextSubstring(species_1, 1,2, 'translation', 'species_code_mapping', 'nl_species_codes', 'casfri_species_codes', TRUE, TRUE)","Check species code is long enough to have a species_1. Get the species_1 substring, check its in the lookup table, then translate it.",TRUE
14,SPECIES_PER_1,integer,"nl_nli01_isCommercial(stand_id, working_group|-8887);notNull(species_per_1);notEmpty(species_per_1);lengthMatchList(species_per_1, {2,4,6}|-8887)","lengthMapInt(species_per_1, {2,4,6}, {100,60,40})",Check species code is long enough to have a species_1. Return correct percent based on the total number of species.,TRUE
15,SPECIES_2,text,"nl_nli01_isCommercial(stand_id, working_group|NOT_APPLICABLE);notNull(species_2);notEmpty(species_2);lengthMatchList(species_2, {4,6}|NOT_APPLICABLE);matchTableSubstring(species_2, 3,2, 'translation', 'species_code_mapping', 'nl_species_codes', TRUE, TRUE)","lookupTextSubstring(species_2, 3,2, 'translation', 'species_code_mapping', 'nl_species_codes', 'casfri_species_codes', TRUE, TRUE)","Check species code is long enough to have a species_2. Get the species_2 substring, check its in the lookup table, then translate it.",TRUE
16,SPECIES_PER_2,integer,"nl_nli01_isCommercial(stand_id, working_group|-8887);notNull(species_per_2);notEmpty(species_per_2);lengthMatchList(species_per_2, {4,6}|-8887)","lengthMapInt(species_per_2, {4,6}, {40,30})",Check species code is long enough to have a species_3. Return correct percent based on the total number of species.,TRUE
17,SPECIES_3,text,"nl_nli01_isCommercial(stand_id, working_group|NOT_APPLICABLE);notNull(species_3);notEmpty(species_3);lengthMatchList(species_3, {6}|NOT_APPLICABLE);matchTableSubstring(species_3, 5,2, 'translation', 'species_code_mapping', 'nl_species_codes', TRUE, TRUE)","lookupTextSubstring(species_3, 5,2, 'translation', 'species_code_mapping', 'nl_species_codes', 'casfri_species_codes', TRUE, TRUE)","Check species code is long enough to have a species_3. Get the species_3 substring, check its in the lookup table, then translate it.",TRUE
18,SPECIES_PER_3,integer,"nl_nli01_isCommercial(stand_id, working_group|-8887);notNull(species_per_3);notEmpty(species_per_3);lengthMatchList(species_per_3, {6}|-8887)","lengthMapInt(species_per_3, {6}, {30})",Check species code is long enough to have a species_3. Return correct percent based on the total number of species.,TRUE
19,SPECIES_4,text,false(),nothingText(),Attribute does not occur,TRUE
20,SPECIES_PER_4,integer,false(),nothingInt(),Attribute does not occur,TRUE
21,SPECIES_5,text,false(),nothingText(),Attribute does not occur,TRUE
22,SPECIES_PER_5,integer,false(),nothingInt(),Attribute does not occur,TRUE
23,SPECIES_6,text,false(),nothingText(),Attribute does not occur,TRUE
24,SPECIES_PER_6,integer,false(),nothingInt(),Attribute does not occur,TRUE
25,SPECIES_7,text,false(),nothingText(),Attribute does not occur,TRUE
26,SPECIES_PER_7,integer,false(),nothingInt(),Attribute does not occur,TRUE
27,SPECIES_8,text,false(),nothingText(),Attribute does not occur,TRUE
28,SPECIES_PER_8,integer,false(),nothingInt(),Attribute does not occur,TRUE
29,SPECIES_9,text,false(),nothingText(),Attribute does not occur,TRUE
30,SPECIES_PER_9,integer,false(),nothingInt(),Attribute does not occur,TRUE
31,SPECIES_10,text,false(),nothingText(),Attribute does not occur,TRUE
32,SPECIES_PER_10,integer,false(),nothingInt(),Attribute does not occur,TRUE
33,ORIGIN_UPPER,integer,"notNull(origin_upper);notEmpty(src_filename);notEmpty(origin_upper|-8888);notEmpty(src_filename|-8888);isInt(origin_upper);isBetween(origin_upper,1, 9|-9997);nl_nli01_origin_newfoundland_validation(origin_upper, src_filename|-9997);geoIntersectionGreaterThan(wkb_geometry, 'rawfri', 'nl_photoyear', 'wkb_geometry', 'photoyear', 'GREATEST_AREA', 0)","nl_nli01_origin_upper_translation(origin_upper, src_filename, wkb_geometry)",Translation is different for Newfoundland and Labrador. Check there is a age code of 1 to 9. 8 and 9 are only valid for Labrador so make sure Newfoundland doesnt have these values. Translation determines if polygon is in Newfoundland or Labrador based on src_filename. Finally check the photo year is not zero. Then runs the correct mapping. ,TRUE
34,ORIGIN_LOWER,integer,"notNull(origin_lower);notEmpty(src_filename);notEmpty(origin_lower|-8888);notEmpty(src_filename|-8888);isInt(origin_lower);isBetween(origin_lower, 1, 9|-9997);nl_nli01_origin_newfoundland_validation(origin_lower, src_filename|-9997);nl_nli01_origin_lower_validation(origin_lower, src_filename|-8886);geoIntersectionGreaterThan(wkb_geometry, 'rawfri', 'nl_photoyear', 'wkb_geometry', 'photoyear', 'GREATEST_AREA', 0)","nl_nli01_origin_lower_translation(origin_lower, src_filename, wkb_geometry)",Translation is different for Newfoundland and Labrador. Check there is a age code of 1 to 9. 8 and 9 are only valid for Labrador so make sure Newfoundland doesnt have these values. Translation determines if polygon is in Newfoundland or Labrador based on src_filename. Then runs the correct mapping. For age class 7 in Newfoundland upper age bound is 121+ which means lower origin is unknown. Same for age class 9 in Labrador where age class is 161+. Catch these with nl_nli01_origin_lower_validation. Finally check the photo year is greater than zero.,TRUE
35,SITE_CLASS,text,"nl_nli01_isCommercial(stand_id, working_group|NOT_APPLICABLE);notNull(site_class);notEmpty(site_class);matchList(site_class, {'p','P','m','M','g','G','h','H'})","mapText(site_class, {'p','P','m','M','g','G','h','H'}, {'POOR','POOR','MEDIUM','MEDIUM','GOOD','GOOD','GOOD','GOOD'})","Concatenates values from 2 attributes and maps to SITE_CLASS using list of values. Usually only one of the attributes will occur per row in the source data, the other will be set to 0. Target values are based on the translation for the non-zero value.",TRUE
36,SITE_INDEX,double precision,false(),nothingDouble(),Attribute does not occur,TRUE
