---  
title: "LYR Attributes"
output:  
  html_document:  
    code_folding: hide
    toc: true
    toc_float:
      collapsed: false
    css: styles.css
---  

<br>

# What's new

<br>

# Overview

  * See comments under individual attribute heading

<br>

# Attributes

## soil_moist_reg {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, soil_moist_reg=0)
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```
### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["soil_moist_reg"], graph.col=FALSE, max.distinct.values=99)
```

## structure_per {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, structure_per=0)
```

### RAWFRI

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["structure_per"], graph.col=FALSE, max.distinct.values=99)
```

## layer {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, layer=1)
```

### RAWFRI

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["layer"], graph.col=FALSE, max.distinct.values=99)
```

## layer_rank {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, layer_rank=1)
```

### RAWFRI

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["layer_rank"], graph.col=FALSE, max.distinct.values=99)
```

## crown_closure {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
friList = c(1,2,3,4,5)
casListLower = c(10,31,51,71,91)
casListUpper = c(30,50,70,90,100)
x = mutate(x, crown_closure_lower=if_else(str_trim(l1cc)=="", -9998, as.double(mapvalues(l1cc, friList, casListLower))),
              crown_closure_upper=if_else(str_trim(l1cc)=="", -9998, as.double(mapvalues(l1cc, friList, casListUpper))))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["l1cc"], graph.col=FALSE, max.distinct.values=101)
```

### CASFRI (lower)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["crown_closure_lower"], graph.col=FALSE, max.distinct.values=101)
```

### CASFRI (upper)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["crown_closure_upper"], graph.col=FALSE, max.distinct.values=101)
```

## height {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, height_upper=if_else(l1ht<0.1 | l1ht>100, -9999, as.double(l1ht)),
              height_lower=if_else(l1ht<0.1 | l1ht>100, -9999, as.double(l1ht)))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["l1ht"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI (lower)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["height_lower"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI (upper)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["height_upper"], graph.col=FALSE, max.distinct.values=99)
```

## species_1-10 {.tabset}

  * The attributes species_1 - species_6 use a lookup table to translate species codes to the CASFRI standard. Here, we demonstrate the code for species_1 only since the same procedure is used for the other species.

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, species_1=if_else(str_trim(l1s1)=="", "EMPTY_STRING", l1s1))
```

```{r echo=TRUE, message=FALSE, warning=FALSE}  
sppList = read_csv("../../translation/tables/lookup/bc_vri01_species.csv")
x = mutate(x, species_1=case_when(
    is.na(species_cd_1) ~ "NULL_VALUE",
    str_trim(species_cd_1)=="" ~ "EMPTY_STRING",
    !species_cd_1 %in% sppList$SOURCE_VAL ~ "NOT_IN_SET",
    TRUE ~ mapvalues(species_cd_1, sppList$SOURCE_VAL, sppList$SPEC1)))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["l1s1"], graph.col=FALSE, max.distinct.values=99)
```
### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["species_1"], graph.col=FALSE, max.distinct.values=99)
```

## species_per_1-10 {.tabset}

  * The attributes species_per_1 - species_per_6 are simply copied from the attributes species_pct_1 - species_pct_6

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, species_per_1=l1pr1)
```

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, species_per_1=case_when(
    is.na(species_pct_1) ~ -8888,
    species_pct_1 < 0 | species_pct_1 > 100 ~ -9999,
    TRUE ~ species_pct_1))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["l1pr1"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["species_per_1"], graph.col=FALSE, max.distinct.values=99)
```

## productive_for {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
#x = mutate(x, productive_for=if_else(modcon1!="CC" & species_1=="EMPTY_STRING" & (crown_closure_upper!=-9998 | height_upper!=-9999), "PP", "PF"))
x = mutate(x, structure_per = -8888, layer=1, layer_rank=1, productive_for = "PF" )
x = mutate(x, productive_for=if_else((!is.na(l1s1) & str_trim(l1s1)=="") & (!is.na(l1cc) | !is.na(l1ht)), "PP", productive_for))
x = mutate(x, productive_for=if_else(!is.na(l1trt) & l1trt=="CC","PF", productive_for))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["productive_for"], graph.col=FALSE, max.distinct.values=99)
```

## origin {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
x = mutate(x, origin_upper=if_else(l1estyr==0,-9999,as.double(l1estyr)),
              origin_lower=if_else(l1estyr==0,-9999,as.double(l1estyr)))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["l1estyr"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI (lower)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["origin_lower"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI (upper)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["origin_upper"], graph.col=FALSE, max.distinct.values=99)
```

## site_class {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, site_class=0)
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["site_class"], graph.col=FALSE, max.distinct.values=99)
```

## site_index {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
x = mutate(x, site_index=-8887)
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["site_index"], graph.col=FALSE, max.distinct.values=99)
```
