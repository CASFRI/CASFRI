---  
title: "NFL Attributes"
output:  
  html_document:  
    code_folding: hide
    toc: true
    toc_float:
      collapsed: false
    css: styles.css
---  

<br>

# What's new

<br>

# Overview

  * Overstory: nfl, (nfl_per?), nat_non, anth_veg, anth_non
  * Understory: unfl, unfl_per, unat_non, uanth_veg, uanth_non
  * nat_non_veg
    - "NMG" => "SA", #or SD?  VERIFY THIS (from ab perl code)
  * nat_non_anth
    - last class is TN or BT?
    - SL = AS (guess from Cosco)
  * non_veg_for
    - Check AB perl code for SC, SO

<br>

# Attributes



## nat_non_veg {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
friList = c('NMB','NWF','NWL')
casList = c('EX','FL','LA')
x = mutate(x, nat_non_veg=case_when(
    str_trim(nat_non)=="" ~ "EMPTY_STRING",
    is.na(nat_non) ~ "NULL_VALUE",
    !nat_non %in% friList ~ "NOT_IN_SET",
    TRUE ~ mapvalues(nat_non, friList, casList)
    ))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nat_non"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nat_non_veg"], graph.col=FALSE, max.distinct.values=99)
```

## non_for_anth {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('AIG','AIH','CIP','CIW')
casList = c('IN','FA','FA','FA')
x = unite(x, anth_veg_anth_non, c(anth_veg, anth_non), sep="", remove=FALSE) %>%
    mutate(anth_veg_anth_non = str_trim(anth_veg_anth_non),
    non_for_anth=case_when(
    str_trim(anth_veg_anth_non)=="" ~ "EMPTY_STRING",
    is.na(anth_veg_anth_non) ~ "NULL_VALUE",
    !anth_veg_anth_non %in% friList ~ "NOT_IN_SET",
    TRUE ~ mapvalues(anth_veg_anth_non, friList, casList)
    ))
```

### RAWFRI (anth_veg)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["anth_veg"], graph.col=FALSE, max.distinct.values=99)
```

### RAWFRI (anth_non)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["anth_non"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["non_for_anth"], graph.col=FALSE, max.distinct.values=99)
```

## non_for_veg {.tabset}

  * Check AB perl code for SC, SO

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('HF','HG','SC','SO')
casList = c('HF','HG','SC','SO')
x = mutate(x, non_for_veg=case_when(
    str_trim(nfl)=="" ~ "EMPTY_STRING",
    is.na(nfl) ~ "NULL_VALUE",
    !nfl %in% friList ~ "NOT_IN_SET",
    TRUE ~ mapvalues(nfl, friList, casList)
    ))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["non_for_veg"], graph.col=FALSE, max.distinct.values=99)
```

## soil_moist_reg {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
friList = c('a','A','d','D','m','M','w','W')
casList = c('A','A','D','D','F','F','W','W')
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_soil_moist_reg = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(moist_reg) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & str_trim(moist_reg)=="" ~ as.integer(-8885),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & !moist_reg %in% friList ~ as.integer(-9998),
    TRUE ~ as.integer(mapvalues(moist_reg, friList, casList))))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```
### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_soil_moist_reg"], graph.col=FALSE, max.distinct.values=99)
```

## structure_per {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_structure_per = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(struc_val) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & (struc_val < 1 | struc_val > 9) ~ as.integer(-9998),
    TRUE ~ struc_val))
```

### RAWFRI

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_structure_per"], graph.col=FALSE, max.distinct.values=99)
```

## crown_closure_upper {.tabset}

  * density has " " values but no nulls - we need an integer error code for empty string [temp: Empty string = -8885]

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('A','B','C','D')
casListUpper = c(30,50,70,100)
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_crown_closure_upper = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(density) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & str_trim(density)=="" ~ as.integer(-8885),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & !density %in% friList ~ as.integer(-9998),
    TRUE ~ as.integer(mapvalues(density, friList, casListUpper))))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_crown_closure_upper"], graph.col=FALSE, max.distinct.values=99)
```

## crown_closure_lower {.tabset}


  * density has " " values but no nulls - we need an integer error code for empty string [temp: Empty string = -8885]

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('A','B','C','D')
casListLower = c(6,31,51,71)
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_crown_closure_lower = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(density) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & str_trim(density)=="" ~ as.integer(-8885),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & !density %in% friList ~ as.integer(-9998),
    TRUE ~ as.integer(mapvalues(density, friList, casListUpper))))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_crown_closure_lower"], graph.col=FALSE, max.distinct.values=99)
```

## height_upper {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_height_upper = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(height) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & (height < 1 | height > 100) ~ as.integer(-9998),
    TRUE ~ height))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_height_upper"], graph.col=FALSE, max.distinct.values=99)
```

## height_lower {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, nfl_height_lower = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(height) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & (height < 1 | height > 100) ~ as.integer(-9998),
    TRUE ~ height))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_height_lower"], graph.col=FALSE, max.distinct.values=99)
```
