---  
title: "NFL Attributes"
output:  
  html_document:  
    code_folding: hide
    toc: true
    toc_float:
      collapsed: false
    css: styles.css
---  

<br>

# What's new

<br>

# Overview

  * Overstory: nonfor_veg, (nonforvecl?), anthro_veg, anth_noveg, nat_nonveg
  * Understory: nonforvegu, nforvegclu, us_anthveg, us_annoveg, us_natnveg

<br>

# Attributes

## nat_non_veg {.tabset}

```{r echo=FALSE, message=FALSE, warning=FALSE}  
friList = c('MB','MC','MS','WF','WL','WR')
casList = c('EX','RK','WS','FL','LA','RI')
x = mutate(x, nat_non_veg=case_when(
    str_trim(nat_nonveg)=="" ~ "EMPTY_STRING",
    is.na(nat_nonveg) ~ "NULL_VALUE",
    !nat_nonveg %in% friList ~ "NOT_IN_SET",
    TRUE ~ mapvalues(nat_nonveg, friList, casList)
    ))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nat_nonveg"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nat_non_veg"], graph.col=FALSE, max.distinct.values=99)
```

## non_for_anth {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('A','IP','IW','P','PR','IG','IH','II','SR')
casList = c('CL','FA','FA','CL','CL','IN','FA','IN','SE')
x = unite(x, anth_veg_anth_non, c(anthro_veg, anth_noveg), sep="", remove=FALSE) %>%
    mutate(anth_veg_anth_non = str_trim(anth_veg_anth_non),
    non_for_anth=case_when(
    str_trim(anth_veg_anth_non)=="" ~ "EMPTY_STRING",
    is.na(anth_veg_anth_non) ~ "NULL_VALUE",
    !anth_veg_anth_non %in% friList ~ "NOT_IN_SET",
    TRUE ~ mapvalues(anth_veg_anth_non, friList, casList)
    ))
```

### RAWFRI (anthro_veg)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["anthro_veg"], graph.col=FALSE, max.distinct.values=99)
```

### RAWFRI (anth_noveg)

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["anth_noveg"], graph.col=FALSE, max.distinct.values=99)

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["non_for_anth"], graph.col=FALSE, max.distinct.values=99)
```

## non_for_veg {.tabset}

  * Check AB perl code for SC, SO

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('BR','HF','HG','SC','SO')
casList = c('BR','HF','HG','SC','SO')
x = mutate(x, non_for_veg=case_when(
    str_trim(nonfor_veg)=="" ~ "EMPTY_STRING",
    is.na(nonfor_veg) ~ "NULL_VALUE",
    !nonfor_veg %in% friList ~ "NOT_IN_SET",
    TRUE ~ mapvalues(nonfor_veg, friList, casList)
    ))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nonfor_veg"], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["non_for_veg"], graph.col=FALSE, max.distinct.values=99)
```

## soil_moist_reg {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
friList = c('a','A','d','D','m','M','w','W')
casList = c('A','A','D','D','F','F','W','W')
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_soil_moist_reg = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(moisture) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & str_trim(moisture)=="" ~ as.integer(-8885),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & !moisture %in% friList ~ as.integer(-9998),
    TRUE ~ as.integer(mapvalues(moisture, friList, casList))))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```
### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_soil_moist_reg"], graph.col=FALSE, max.distinct.values=99)
```

## structure_per {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('0','0','C4','C5','M','M0','MO')
casList = c(-9999,-9999,4,5,-9999,-9999,-9999)
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_structure_per = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(std_struct) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & str_trim(std_struct)=="" ~ as.integer(-8885),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & !std_struct %in% friList ~ as.integer(-9998),
    TRUE ~ as.integer(mapvalues(std_struct, friList, casList))))
```

### RAWFRI

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_structure_per"], graph.col=FALSE, max.distinct.values=99)
```

## crown_closure_upper {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('A','B','C','D')
casListUpper = c(30,50,70,100)
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_crown_closure_upper = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(crownclose) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & str_trim(crownclose)=="" ~ as.integer(-8885),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & !crownclose %in% friList ~ as.integer(-9998),
    TRUE ~ as.integer(mapvalues(crownclose, friList, casListUpper))))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_crown_closure_upper"], graph.col=FALSE, max.distinct.values=99)
```

## crown_closure_lower {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}
friList = c('A','B','C','D')
casListLower = c(6,31,51,71)
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_crown_closure_lower = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(crownclose) ~ as.integer(-8888),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & str_trim(crownclose)=="" ~ as.integer(-8885),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & !crownclose %in% friList ~ as.integer(-9998),
    TRUE ~ as.integer(mapvalues(crownclose, friList, casListLower))))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_crown_closure_lower"], graph.col=FALSE, max.distinct.values=99)
```

## height_upper {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
errorList = c("NULL_VALUE","EMPTY_STRING","NOT_IN_SET")
x = mutate(x, nfl_height_upper = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(height) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & (height < 1 | height > 100) ~ as.integer(-9998),
    TRUE ~ as.integer(height)))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_height_upper"], graph.col=FALSE, max.distinct.values=99)
```

## height_lower {.tabset}

```{r echo=TRUE, message=FALSE, warning=FALSE}  
x = mutate(x, nfl_height_lower = case_when(
    (nat_non_veg %in% errorList & non_for_anth %in% errorList & non_for_veg %in% errorList) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & is.na(height) ~ as.integer(-8887),
    (!nat_non_veg %in% errorList | !non_for_anth %in% errorList | !non_for_veg %in% errorList) & (height < 1 | height > 100) ~ as.integer(-9998),
    TRUE ~ as.integer(height)))
```

### RAWFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
#dfSummary(x[""], graph.col=FALSE, max.distinct.values=99)
```

### CASFRI

```{r echo=FALSE, message=FALSE, warning=FALSE}  
dfSummary(x["nfl_height_lower"], graph.col=FALSE, max.distinct.values=99)
```
