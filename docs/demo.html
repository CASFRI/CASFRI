<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>demo.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">



<div id="casfriHeader" class="alwaysShrunk">
  <div class="innards bandContent">
    <div>
      <div class="casfri"><a href="index.html"><div class="logo"></div></a></div>
    </div>

    <div id="menu">
      <div id="menuToggler"></div>
      <div id="menuItems">
        <a class="menuItem" href="about.html">About</a>
        <a class="menuItem" href="demo.html">Demo</a>
        <a class="menuItem" href="projects.html">Projects</a>
        <a class="menuItem" href="data.html">Data</a>
        <a class="menuItem gitHub" href="https://github.com/edwardsmarc/CASFRI"></a>
        <a class="menuItem gitHubText" href="https://github.com/edwardsmarc/CASFRI">Source on GitHub</a>
      </div>
    </div>
  </div>
</div>

<style type="text/css">
#TOC {
  margin-left: 35px;
  margin-top: 90px;
}
</style>

<script type="text/javascript">
$(".main-container").removeClass("main-container").removeClass("container-fluid").addClass("footerPushDown");
</script>


<div id="pageContent" class="standardPadding">
  <div class="articleBandContent">

<div class="fluid-row" id="header">




</div>


<div id="demo" class="section level1">
<h1>Demo</h1>
<p>The following two examples demonstrate questions that CASFRI can help answer. Since CASFRI is stored in a PostgreSQL database, we use SQL queries to extract the required data. The queries below reference the <a href="https://github.com/edwardsmarc/CASFRI/tree/master/docs/specifications">CASFRI specifications</a> and use the valid_year_begin and valid_year_end attributes which are explained in the CASFRI <a href="https://github.com/edwardsmarc/CASFRI">readMe</a> on Github.</p>
<p><br> <br></p>
<div id="question-1-what-is-the-most-current-information-on-the-distribution-of-lodgepole-pine-in-bc-and-yukon" class="section level2">
<h2>Question 1: What is the most current information on the distribution of lodgepole pine in BC and Yukon?</h2>
<ul>
<li><p>To answer this question we want to query the CASFRI database to get the most recent forest species information from BC and Yukon.</p></li>
<li><p>We only want to extract CASFRI polygons where the leading species is lodgepole pine.</p></li>
<li><p>This equates to all polygons where the valid year is 2020, the CAS_ID matches either ‘BC’ or ‘YT’, the LAYER attribute is 1, and the SPECIES_1 attribute is one of PINU_CON_CON, PINU_CON_LAT, or PINU_CON_###.</p></li>
</ul>
<p>The following query extracts the data which we can then visulaize using QGIS. The query identifies the valid polygons and joins them to the LYR and GEO tables. It then queries to get the polygons with leading lodgepole pine in BC and Yukon:</p>
<pre><code>CREATE TABLE casfri50_test.demo_1 AS
WITH valid_polygons AS(
    SELECT cas_id cas_id_valid
    FROM casfri50_history.geo_history gh
    WHERE gh.valid_year_begin &lt;= 2020 AND 2020 &lt;= gh.valid_year_end
)
SELECT *
FROM valid_polygons
LEFT JOIN casfri50.lyr_all lyr ON valid_polygons.cas_id_valid = lyr.cas_id
LEFT JOIN (SELECT cas_id AS geo_cas_id, geometry FROM casfri50.geo_all) geo ON valid_polygons.cas_id_valid = geo.geo_cas_id
WHERE LEFT(cas_id, 2) IN(&#39;BC&#39;,&#39;YT&#39;) AND LAYER = 1 AND SPECIES_1 IN(&#39;PINU_CON_CON&#39;, &#39;PINU_CON_LAT&#39;, &#39;PINU_CON_###&#39;);</code></pre>
<center>
<img src="images/demo_fig.png" style="width:70.0%" />
</center>
<p><br> <br></p>
</div>
<div id="question-2-what-was-the-age-of-all-forest-stands-acsross-quebec-and-new-brunswick-in-2015" class="section level2">
<h2>Question 2: What was the age of all forest stands acsross Quebec and New Brunswick in 2015?</h2>
<ul>
<li><p>To answer this question we want to query the CASFRI database to get the most valid information that is available for the year 2015. Since all jurisdictions produce inventories on different schedules, the most valid information could be from before or after 2015.</p></li>
<li><p>We will query the database using the year 2015, and only return the LYR rows where LAYER is 1.</p></li>
<li><p>We can then calculate age as a new attribute using the formula <code>2015 - ((ORIGIN_UPPER+ORIGIN_LOWER)/2)</code>.</p></li>
</ul>
<p>With the following query, we select the most valid polygons in 2015 and join them to the LYR and GEO tables. We then calculate age for all stands originating in 2015 or earlier as the average origin value subtracted from 2015. We discard any polygons where the origin is &gt;2015 (these polygons might be the most valid information we have for 2015, but since they originate after 2015 we cannot calculate an age for them). Blank areas on the map are either non-forested, missing data, or do not have sufficient information to calculate age.</p>
<pre><code>CREATE TABLE casfri50_test.demo_2 AS
WITH valid_polygons AS(
    SELECT cas_id cas_id_valid
    FROM casfri50_history.geo_history gh
    WHERE gh.valid_year_begin &lt;= 2015 AND 2015 &lt;= gh.valid_year_end
)
SELECT *, 2015-((ORIGIN_UPPER+ORIGIN_LOWER)/2) age
FROM valid_polygons
LEFT JOIN casfri50.lyr_all lyr ON valid_polygons.cas_id_valid = lyr.cas_id
LEFT JOIN (SELECT cas_id AS geo_cas_id, geometry FROM casfri50.geo_all) geo ON valid_polygons.cas_id_valid = geo.geo_cas_id
WHERE LEFT(cas_id, 2) IN(&#39;QC&#39;,&#39;NB&#39;) AND LAYER = 1 AND ORIGIN_UPPER &gt; 0 AND ORIGIN_UPPER &lt;= 2015;</code></pre>
<center>
<img src="images/demo2_fig.png" style="width:90.0%" />
</center>
</div>
</div>

</div> <!-- articleBandContent -->
</div> <!-- pageContent -->

<div id="casfriFooter" class="band full">
  <div class="bandContent">
    <div id="developedBy" style="font-size:18px;">Developed by Pierre Racine, Marc Edwards,<br>Melina Houle, Pierre Vernier and Steve Cumming.
      <br>
      <br>
      <div style="font-size:12px">Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>
      </div>
    </div>
    <div id="logos">
      <a href="https://github.com/rstudio" class="footerLogo gitHub"></a>
    </div>
  </div>
  
</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



</body>
</html>
